# abismal benchmark

This repository contains a set of programs used to compare mapping
results of abismal and multiple WGBS mappers. Here we list what the
programs do and why they are needed

# R script to generate manuscript figures

To generate the figures and tables from the manuscript, run the following
command:

```
$ Rscript R/benchmark.r
```

This will generate the manuscript figures and supplementary tables
under the `results/figures`  and `results/tables` directories.
respectively. Figures and tables are generated by parsing files under
`results/benchmark-files`, which were generated by running each mapper
on the input FASTQ files and analyzing mapper outputs using methpipe.

Alternatively, in an R environment, run
```
> source('R/benchmark.r')
```

This script will create the following objects in an R environment:
 - `sim.tbl` : contains specificity, sensitivity and F1 scores for
   simulated reads. It reads files from the `simulation_analysis`
   directory
 - `tbl` : coerces all files inside `results/benchmark-files` into a
   large table.
 - `times` and `mems` contain time and memory used to map reads for
   each sample and each mapper.

# Auxiliary C++ scripts

### hash_counter

This program was used to generate Figure 1B.

This code counts the real and theoretical ratios in a reference genome
given a number of bits. It estimates the probabilities of weak and
strong bases from a genome, and it counts the number of k-mers under
two- and three-letter encodings. It then compares the two- and
three-letter encoding ratios, both in practice (using the k-mer counts
from the genome) and in the developed i.i.d. theory. For instance, to
summarize the hit ratios for 26 bits in the human genome, run

```
$ hash_counter -b 26 -o stats.tsv /path/to/hg38.fa
```

### mr-to-sam

This program converts WALT output from MR to SAM. This is equivalent
to `format_reads` in methpipe, where the resulting sam file is
single-ended.

```
$ mr-to-sam -o <sam-output> <mr-input>
```

### fix-bismark-sam

This program takes the bismark input and corrects some of its output
suitable for accuracy comparison: It uses the XM tag to subtract from the
edit distance the bases that were counted as mismatches due to bisulfite
conversion. It also formats the read name adding the .1 and .2 to read
names as it was standardized for other mappers. 

```
fix-bismark-sam -o bismark_fixed.sam bismark_original.sam
```

### fix-bwa-sam

This program adjusts the output of BWA-meth to remove reads flagged as
unmapped and filter reads that are within the standardized edit
distance used across mappers.

```
fix-bwasam -o bwa_fixed.sam bwa_original.sam
```

### sherman-accuracy.cpp

This program compares the SAM chromosome name, position and strand
with the true location, given in the Sherman read names when they are
simulated.
